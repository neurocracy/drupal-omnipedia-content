services:

  # The Omnipedia wiki node changes cache bin.
  cache.omnipedia_wiki_node_changes:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
      - { name: cache.bin }
    factory: cache_factory:get
    arguments: [omnipedia_wiki_node_changes]

  # The Omnipedia wiki node changes service.
  omnipedia.wiki_node_changes:
    class: Drupal\omnipedia_content_changes\Service\WikiNodeChanges
    arguments:
      - '@entity_type.manager'
      - '@event_dispatcher'
      - '@diff.html_diff'
      - '@renderer'
      - '@omnipedia.wiki_node_changes_cache'

  # The Omnipedia wiki node changes cache service.
  omnipedia.wiki_node_changes_cache:
    class: Drupal\omnipedia_content_changes\Service\WikiNodeChangesCache
    arguments:
      - '@cache.omnipedia_wiki_node_changes'
      - '@omnipedia.wiki_node_changes_info'

  # The Omnipedia wiki node changes info service.
  omnipedia.wiki_node_changes_info:
    class: Drupal\omnipedia_content_changes\Service\WikiNodeChangesInfo
    arguments:
      - '@cache_contexts_manager'
      - '@entity_type.manager'
      - '@omnipedia.wiki_node_changes_user'

  # The Omnipedia wiki node changes user service.
  omnipedia.wiki_node_changes_user:
    class: Drupal\omnipedia_content_changes\Service\WikiNodeChangesUser
    arguments:
      - '@cache.default'
      - '@entity_type.manager'
      - '@user_permissions_hash_generator'

  # Event subscriber to alter any changed wiki node changes diff content.
  omnipedia_content_changes.diff_alter_changed_content_event_subscriber:
    class: Drupal\omnipedia_content_changes\EventSubscriber\Omnipedia\Changes\DiffAlterChangedContentEventSubscriber
    tags:
      - { name: 'event_subscriber', priority: -20 }

  # Event subscriber to alter any added wiki node changes diff content.
  omnipedia_content_changes.diff_alter_added_content_event_subscriber:
    class: Drupal\omnipedia_content_changes\EventSubscriber\Omnipedia\Changes\DiffAlterAddedContentEventSubscriber
    tags:
      - { name: 'event_subscriber', priority: -15 }

  # Event subscriber to alter any removed wiki node changes diff content.
  omnipedia_content_changes.diff_alter_removed_content_event_subscriber:
    class: Drupal\omnipedia_content_changes\EventSubscriber\Omnipedia\Changes\DiffAlterRemovedContentEventSubscriber
    tags:
      - { name: 'event_subscriber', priority: -10 }

  # Event subscriber to alter any links in the wiki node changes diff content.
  omnipedia_content_changes.diff_alter_links_event_subscriber:
    class: Drupal\omnipedia_content_changes\EventSubscriber\Omnipedia\Changes\DiffAlterLinksEventSubscriber
    tags:
      - { name: 'event_subscriber', priority: -5 }

