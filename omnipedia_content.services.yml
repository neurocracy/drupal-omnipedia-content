services:

  # The OmnipediaElement plug-in manager.
  plugin.manager.omnipedia_element:
    class: Drupal\omnipedia_content\OmnipediaElementManager
    parent: default_plugin_manager
    calls:
      -
        - setAddtionalDependencies
        -
          - '@messenger'
          - '@renderer'
          - '@string_translation'

  # The Omnipedia wiki node changes cache bin.
  cache.omnipedia_wiki_node_changes:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
      - { name: cache.bin }
    factory: cache_factory:get
    arguments: [omnipedia_wiki_node_changes]

  # The Omnipedia Wikimedia link service.
  omnipedia.wikimedia_link:
    class: Drupal\omnipedia_content\Service\WikimediaLink
    arguments:
      - '@string_translation'

  # The Omnipedia wiki node changes service.
  omnipedia.wiki_node_changes:
    class: Drupal\omnipedia_content\Service\WikiNodeChanges
    arguments:
      - '@entity_type.manager'
      - '@diff.html_diff'
      - '@renderer'
      - '@omnipedia.wiki_node_changes_cache'

  # The Omnipedia wiki node changes info service.
  omnipedia.wiki_node_changes_info:
    class: Drupal\omnipedia_content\Service\WikiNodeChangesInfo
    arguments:
      - '@cache_contexts_manager'
      - '@cache.default'
      - '@entity_type.manager'
      - '@user_permissions_hash_generator'

  # The Omnipedia wiki node changes cache service.
  omnipedia.wiki_node_changes_cache:
    class: Drupal\omnipedia_content\Service\WikiNodeChangesCache
    arguments:
      - '@cache.omnipedia_wiki_node_changes'
      - '@omnipedia.wiki_node_changes_info'

  # The Omnipedia wiki node changes user service.
  omnipedia.wiki_node_changes_user:
    class: Drupal\omnipedia_content\Service\WikiNodeChangesUser
    arguments:
      - '@entity_type.manager'

  # Event subscriber to add Omnipedia element validation to wiki node edit form.
  omnipedia_content.form_wiki_node_element_validate_event_subscriber:
    class: Drupal\omnipedia_content\EventSubscriber\Form\WikiNodeElementValidateEventSubscriber
    arguments:
      - '@plugin.manager.omnipedia_element'
      - '@renderer'
    tags:
      - { name: 'event_subscriber' }

  # Event subscriber to add CommonMark indented content parser and renderer.
  omnipedia_content.markdown_commonmark_indented_content_event_subscriber:
    class: Drupal\omnipedia_content\EventSubscriber\Markdown\CommonMark\IndentedContentEventSubscriber
    tags:
      - { name: 'event_subscriber' }

  # Event subscriber to expand Wikimedia prefixed link URLs to full URLs.
  omnipedia_content.markdown_commonmark_wikimedia_link_event_subscriber:
    class: Drupal\omnipedia_content\EventSubscriber\Markdown\CommonMark\WikimediaLinkEventSubscriber
    arguments:
      - '@omnipedia.wikimedia_link'
    tags:
      - { name: 'event_subscriber' }

  # OmnipediaElement hook_theme() event subscriber.
  omnipedia_content.theme_omnipedia_element_event_subscriber:
    class: Drupal\omnipedia_content\EventSubscriber\Theme\ThemeOmnipediaElementEventSubscriber
    arguments:
      - '@module_handler'
      - '@plugin.manager.omnipedia_element'
    tags:
      - { name: 'event_subscriber' }

  # hook_views_data() event subscriber to define Omnipedia date plug-ins.
  omnipedia_content.views_data_omnipedia_date_event_subscriber:
    class: Drupal\omnipedia_content\EventSubscriber\Views\ViewsDataOmnipediaDateEventSubscriber
    arguments:
      - '@string_translation'
    tags:
      - { name: 'event_subscriber' }
